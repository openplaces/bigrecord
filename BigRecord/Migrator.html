<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>Class: BigRecord::Migrator</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo; 
    <a title="BigRecord" href="../BigRecord.html">BigRecord</a>
     &raquo; 
    <span class="title">Migrator</span>
  
</div>

      <div id="search">
  <a id="class_list_link" href="#">Namespace List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: BigRecord::Migrator 
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><a title="Object" href="../Object.html">Object</a></span>
      
      </dd>
    
  
  
    
  
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/big_record/migration.rb</dd>
  
</dl>
<div class="clear"></div>




  <h2>Method Summary</h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature"><a title="current_version (class method)" href="#current_version-class_method">+ (Object) <strong>current_version</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="down (class method)" href="#down-class_method">+ (Object) <strong>down</strong>(migrations_path, target_version = nil) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="get_all_versions (class method)" href="#get_all_versions-class_method">+ (Object) <strong>get_all_versions</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="migrate (class method)" href="#migrate-class_method">+ (Object) <strong>migrate</strong>(migrations_path, target_version = nil) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="proper_table_name (class method)" href="#proper_table_name-class_method">+ (Object) <strong>proper_table_name</strong>(name) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="rollback (class method)" href="#rollback-class_method">+ (Object) <strong>rollback</strong>(migrations_path, steps = 1) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="run (class method)" href="#run-class_method">+ (Object) <strong>run</strong>(direction, migrations_path, target_version) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="schema_migrations_table_name (class method)" href="#schema_migrations_table_name-class_method">+ (Object) <strong>schema_migrations_table_name</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="up (class method)" href="#up-class_method">+ (Object) <strong>up</strong>(migrations_path, target_version = nil) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#current_migration (instance method)" href="#current_migration-instance_method">- (Object) <strong>current_migration</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#current_version (instance method)" href="#current_version-instance_method">- (Object) <strong>current_version</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#initialize (instance method)" href="#initialize-instance_method">- (Migrator) <strong>initialize</strong>(direction, migrations_path, target_version = nil) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
A new instance of <tt>Migrator</tt>.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#migrate (instance method)" href="#migrate-instance_method">- (Object) <strong>migrate</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#migrated (instance method)" href="#migrated-instance_method">- (Object) <strong>migrated</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#migrations (instance method)" href="#migrations-instance_method">- (Object) <strong>migrations</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#pending_migrations (instance method)" href="#pending_migrations-instance_method">- (Object) <strong>pending_migrations</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#run (instance method)" href="#run-instance_method">- (Object) <strong>run</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
  </ul>

<div id="constructor_details">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><a title="Migrator" href="">Migrator</a></tt>) <strong>initialize</strong>(direction, migrations_path, target_version = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of <tt>Migrator</tt>
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a title="Migrator" href="">Migrator</a></tt>)</span>
      
      
      
      
        &mdash;
        
a new instance of <tt>Migrator</tt>


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


250
251
252
253
254</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 250</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='direction identifier id'>direction</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='StandardError constant id'>StandardError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;This database does not yet support migrations&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='supports_migrations? fid id'>supports_migrations?</span>
  <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='initialize_schema_migrations_table identifier id'>initialize_schema_migrations_table</span>
  <span class='@direction ivar id'>@direction</span><span class='comma token'>,</span> <span class='@migrations_path ivar id'>@migrations_path</span><span class='comma token'>,</span> <span class='@target_version ivar id'>@target_version</span> <span class='assign token'>=</span> <span class='direction identifier id'>direction</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="method_details">
    <h2>Method Details</h2>
    
      <div class="method_details first">
  <p class="signature first" id="current_version-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>current_version</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 235</span>

<span class='def def kw'>def</span> <span class='current_version identifier id'>current_version</span>
  <span class='sm_table identifier id'>sm_table</span> <span class='assign token'>=</span> <span class='schema_migrations_table_name identifier id'>schema_migrations_table_name</span>
  <span class='if if kw'>if</span> <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='table_exists? fid id'>table_exists?</span><span class='lparen token'>(</span><span class='sm_table identifier id'>sm_table</span><span class='rparen token'>)</span>
    <span class='get_all_versions identifier id'>get_all_versions</span><span class='dot token'>.</span><span class='max identifier id'>max</span> <span class='orop op'>||</span> <span class='integer val'>0</span>
  <span class='else else kw'>else</span>
    <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="down-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>down</strong>(migrations_path, target_version = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 219</span>

<span class='def def kw'>def</span> <span class='down identifier id'>down</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:down</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='migrate identifier id'>migrate</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_all_versions-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>get_all_versions</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 231</span>

<span class='def def kw'>def</span> <span class='get_all_versions identifier id'>get_all_versions</span>
  <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='get_all_schema_versions identifier id'>get_all_schema_versions</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="migrate-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>migrate</strong>(migrations_path, target_version = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 197</span>

<span class='def def kw'>def</span> <span class='migrate identifier id'>migrate</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span>
    <span class='when when kw'>when</span> <span class='target_version identifier id'>target_version</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>              <span class='then then kw'>then</span> <span class='up identifier id'>up</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='current_version identifier id'>current_version</span> <span class='gt op'>&gt;</span> <span class='target_version identifier id'>target_version</span> <span class='then then kw'>then</span> <span class='down identifier id'>down</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>                                       <span class='up identifier id'>up</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="proper_table_name-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>proper_table_name</strong>(name) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 244</span>

<span class='def def kw'>def</span> <span class='proper_table_name identifier id'>proper_table_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='comment val'># Use the Active Record objects own table_name, or pre/suffix from ActiveRecord::Base if name is a symbol/string</span>
  <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='table_name identifier id'>table_name</span> <span class='rescue rescue kw'>rescue</span> <span class='dstring node'>&quot;#{BigRecord::Base.table_name_prefix}#{name}#{BigRecord::Base.table_name_suffix}&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="rollback-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>rollback</strong>(migrations_path, steps = 1) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 205</span>

<span class='def def kw'>def</span> <span class='rollback identifier id'>rollback</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='steps identifier id'>steps</span><span class='assign token'>=</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='migrator identifier id'>migrator</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:down</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='rparen token'>)</span>
  <span class='start_index identifier id'>start_index</span> <span class='assign token'>=</span> <span class='migrator identifier id'>migrator</span><span class='dot token'>.</span><span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='migrator identifier id'>migrator</span><span class='dot token'>.</span><span class='current_migration identifier id'>current_migration</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='start_index identifier id'>start_index</span>

  <span class='finish identifier id'>finish</span> <span class='assign token'>=</span> <span class='migrator identifier id'>migrator</span><span class='dot token'>.</span><span class='migrations identifier id'>migrations</span><span class='lbrack token'>[</span><span class='start_index identifier id'>start_index</span> <span class='plus op'>+</span> <span class='steps identifier id'>steps</span><span class='rbrack token'>]</span>
  <span class='down identifier id'>down</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='finish identifier id'>finish</span> <span class='integer val'>? </span><span class='finish identifier id'>finish</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="run-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>run</strong>(direction, migrations_path, target_version) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 223</span>

<span class='def def kw'>def</span> <span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='direction identifier id'>direction</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='direction identifier id'>direction</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='run identifier id'>run</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="schema_migrations_table_name-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>schema_migrations_table_name</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 227</span>

<span class='def def kw'>def</span> <span class='schema_migrations_table_name identifier id'>schema_migrations_table_name</span>
  <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='table_name_prefix identifier id'>table_name_prefix</span> <span class='plus op'>+</span> <span class='string val'>'schema_migrations'</span> <span class='plus op'>+</span> <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='table_name_suffix identifier id'>table_name_suffix</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="up-class_method">
  
    + (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>up</strong>(migrations_path, target_version = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 215</span>

<span class='def def kw'>def</span> <span class='up identifier id'>up</span><span class='lparen token'>(</span><span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:up</span><span class='comma token'>,</span> <span class='migrations_path identifier id'>migrations_path</span><span class='comma token'>,</span> <span class='target_version identifier id'>target_version</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='migrate identifier id'>migrate</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="current_migration-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>current_migration</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 260</span>

<span class='def def kw'>def</span> <span class='current_migration identifier id'>current_migration</span>
  <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='eq op'>==</span> <span class='current_version identifier id'>current_version</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="current_version-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>current_version</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 256</span>

<span class='def def kw'>def</span> <span class='current_version identifier id'>current_version</span>
  <span class='migrated identifier id'>migrated</span><span class='dot token'>.</span><span class='last identifier id'>last</span> <span class='orop op'>||</span> <span class='integer val'>0</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="migrate-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>migrate</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 273</span>

<span class='def def kw'>def</span> <span class='migrate identifier id'>migrate</span>
  <span class='current identifier id'>current</span> <span class='assign token'>=</span> <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='eq op'>==</span> <span class='current_version identifier id'>current_version</span> <span class='rbrace token'>}</span>
  <span class='target identifier id'>target</span> <span class='assign token'>=</span> <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='eq op'>==</span> <span class='@target_version ivar id'>@target_version</span> <span class='rbrace token'>}</span>

  <span class='if if kw'>if</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@target_version ivar id'>@target_version</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='@target_version ivar id'>@target_version</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='raise identifier id'>raise</span> <span class='UnknownMigrationVersionError constant id'>UnknownMigrationVersionError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@target_version ivar id'>@target_version</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='start identifier id'>start</span> <span class='assign token'>=</span> <span class='up? fid id'>up?</span> <span class='integer val'>? </span><span class='integer val'>0</span> <span class='colon op'>:</span> <span class='lparen token'>(</span><span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='current identifier id'>current</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='finish identifier id'>finish</span> <span class='assign token'>=</span> <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='runnable identifier id'>runnable</span> <span class='assign token'>=</span> <span class='migrations identifier id'>migrations</span><span class='lbrack token'>[</span><span class='start identifier id'>start</span><span class='dot2 op'>..</span><span class='finish identifier id'>finish</span><span class='rbrack token'>]</span>

  <span class='comment val'># skip the last migration if we're headed down, but not ALL the way down</span>
  <span class='runnable identifier id'>runnable</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='if if_mod kw'>if</span> <span class='down? fid id'>down?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='target identifier id'>target</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

  <span class='runnable identifier id'>runnable</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='migration identifier id'>migration</span><span class='bitor op'>|</span>
    <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Migrating to #{migration.name} (#{migration.version})&quot;</span>

    <span class='comment val'># On our way up, we skip migrating the ones we've already migrated</span>
    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='up? fid id'>up?</span> <span class='andop op'>&amp;&amp;</span> <span class='migrated identifier id'>migrated</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>

    <span class='comment val'># On our way down, we skip reverting the ones we've never migrated</span>
    <span class='if if kw'>if</span> <span class='down? fid id'>down?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='migrated identifier id'>migrated</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>
      <span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='announce identifier id'>announce</span> <span class='string val'>'never migrated, skipping'</span><span class='semicolon token'>;</span> <span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='write identifier id'>write</span>
      <span class='next next kw'>next</span>
    <span class='end end kw'>end</span>

    <span class='begin begin kw'>begin</span>
      <span class='ddl_transaction identifier id'>ddl_transaction</span> <span class='do do kw'>do</span>
        <span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='migrate identifier id'>migrate</span><span class='lparen token'>(</span><span class='@direction ivar id'>@direction</span><span class='rparen token'>)</span>
        <span class='record_version_state_after_migrating identifier id'>record_version_state_after_migrating</span><span class='lparen token'>(</span><span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='canceled_msg identifier id'>canceled_msg</span> <span class='assign token'>=</span> <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='supports_ddl_transactions? fid id'>supports_ddl_transactions?</span> <span class='integer val'>? </span><span class='string val'>&quot;this and &quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span>
      <span class='raise identifier id'>raise</span> <span class='StandardError constant id'>StandardError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;An error has occurred, #{canceled_msg}all later migrations canceled:\n\n#{e}&quot;</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="migrated-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>migrated</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


347
348
349</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 347</span>

<span class='def def kw'>def</span> <span class='migrated identifier id'>migrated</span>
  <span class='@migrated_versions ivar id'>@migrated_versions</span> <span class='opasgn op'>||=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='get_all_versions identifier id'>get_all_versions</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="migrations-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>migrations</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 312</span>

<span class='def def kw'>def</span> <span class='migrations identifier id'>migrations</span>
  <span class='@migrations ivar id'>@migrations</span> <span class='opasgn op'>||=</span> <span class='begin begin kw'>begin</span>
    <span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='Dir constant id'>Dir</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{@migrations_path}/[0-9]*_*.rb&quot;</span><span class='rbrack token'>]</span>

    <span class='migrations identifier id'>migrations</span> <span class='assign token'>=</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='klasses identifier id'>klasses</span><span class='comma token'>,</span> <span class='file identifier id'>file</span><span class='bitor op'>|</span>
      <span class='version identifier id'>version</span><span class='comma token'>,</span> <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/([0-9]+)_([_a-z0-9]*).rb/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>

      <span class='raise identifier id'>raise</span> <span class='IllegalMigrationNameError constant id'>IllegalMigrationNameError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='version identifier id'>version</span>
      <span class='version identifier id'>version</span> <span class='assign token'>=</span> <span class='version identifier id'>version</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

      <span class='if if kw'>if</span> <span class='klasses identifier id'>klasses</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='eq op'>==</span> <span class='version identifier id'>version</span> <span class='rbrace token'>}</span>
        <span class='raise identifier id'>raise</span> <span class='DuplicateMigrationVersionError constant id'>DuplicateMigrationVersionError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='version identifier id'>version</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='if if kw'>if</span> <span class='klasses identifier id'>klasses</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='eq op'>==</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='camelize identifier id'>camelize</span> <span class='rbrace token'>}</span>
        <span class='raise identifier id'>raise</span> <span class='DuplicateMigrationNameError constant id'>DuplicateMigrationNameError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='camelize identifier id'>camelize</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='migration identifier id'>migration</span> <span class='assign token'>=</span> <span class='MigrationProxy constant id'>MigrationProxy</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
      <span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='name identifier id'>name</span>     <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='camelize identifier id'>camelize</span>
      <span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='version identifier id'>version</span>  <span class='assign token'>=</span> <span class='version identifier id'>version</span>
      <span class='migration identifier id'>migration</span><span class='dot token'>.</span><span class='filename identifier id'>filename</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span>
      <span class='klasses identifier id'>klasses</span> <span class='lshft op'>&lt;&lt;</span> <span class='migration identifier id'>migration</span>
    <span class='end end kw'>end</span>

    <span class='migrations identifier id'>migrations</span> <span class='assign token'>=</span> <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:version</span><span class='rparen token'>)</span>
    <span class='down? fid id'>down?</span> <span class='integer val'>? </span><span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span> <span class='colon op'>:</span> <span class='migrations identifier id'>migrations</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pending_migrations-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>pending_migrations</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 342</span>

<span class='def def kw'>def</span> <span class='pending_migrations identifier id'>pending_migrations</span>
  <span class='already_migrated identifier id'>already_migrated</span> <span class='assign token'>=</span> <span class='migrated identifier id'>migrated</span>
  <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='reject identifier id'>reject</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='already_migrated identifier id'>already_migrated</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="run-instance_method">
  
    - (<tt><a title="Object" href="../Object.html">Object</a></tt>) <strong>run</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><a title="UnknownMigrationVersionError" href="UnknownMigrationVersionError.html">UnknownMigrationVersionError</a></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267
268
269
270
271</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/big_record/migration.rb', line 264</span>

<span class='def def kw'>def</span> <span class='run identifier id'>run</span>
  <span class='target identifier id'>target</span> <span class='assign token'>=</span> <span class='migrations identifier id'>migrations</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='eq op'>==</span> <span class='@target_version ivar id'>@target_version</span> <span class='rbrace token'>}</span>
  <span class='raise identifier id'>raise</span> <span class='UnknownMigrationVersionError constant id'>UnknownMigrationVersionError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@target_version ivar id'>@target_version</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
  <span class='unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='up? fid id'>up?</span> <span class='andop op'>&amp;&amp;</span> <span class='migrated identifier id'>migrated</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='down? fid id'>down?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='migrated identifier id'>migrated</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='migrate identifier id'>migrate</span><span class='lparen token'>(</span><span class='@direction ivar id'>@direction</span><span class='rparen token'>)</span>
    <span class='record_version_state_after_migrating identifier id'>record_version_state_after_migrating</span><span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov 26 18:22:09 2009 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.4.0 (ruby-1.8.7).
</div>

  </body>
</html>